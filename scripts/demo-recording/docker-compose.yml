# Demo Recording Environment - Docker Compose
# Runs code-server in isolation for Playwright demo recordings
# Last Updated: 2026-01-21

services:
  code-server:
    build:
      context: .
      dockerfile: Dockerfile
    image: demo-code-server-custom
    container_name: demo-code-server
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=UTC
      # Disable authentication entirely for demo recording
      - PASSWORD=
      - HASHED_PASSWORD=
      - DEFAULT_WORKSPACE=/config/workspace
    volumes:
      # Mount the settings - needs to be writable for VS Code
      - ./automation-config/settings.json:/config/data/User/settings.json
      # Mount demo notebook
      - ../../demo.ipynb:/config/workspace/demo.ipynb:ro
      # Persist extensions
      - code-server-extensions:/config/extensions
      # Persist VS Code data
      - code-server-data:/config/data
    ports:
      - "8443:8443"
    # Resource limits
    mem_limit: 4g
    cpus: 2.0
    # Recommended Docker settings for browser-based apps
    shm_size: 2gb  # Larger shared memory for video playback

volumes:
  code-server-extensions:
    name: demo-code-server-extensions
  code-server-data:
    name: demo-code-server-data
