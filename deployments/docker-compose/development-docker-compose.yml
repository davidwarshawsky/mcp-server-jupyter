# MCP Jupyter Server - Development Docker Compose
# Minimal security for rapid iteration
# Last Updated: 2025-01-20

version: '3.8'

services:
  mcp-jupyter-dev:
    image: mcp-jupyter:0.2.1
    container_name: mcp-jupyter-dev
    restart: unless-stopped
    
    # Relaxed security for development
    security_opt:
      - no-new-privileges:true
    
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
    
    # Volumes (local bind mounts for code hot-reload)
    volumes:
      - ./workspace:/workspace:rw
      - ./data:/var/mcp-jupyter:rw
      - ./src:/app/src:ro  # Mount source code (read-only)
    
    # Environment Variables (Development)
    environment:
      # Server
      - MCP_HOST=0.0.0.0
      - MCP_PORT=3000
      - LOG_LEVEL=DEBUG
      
      # Persistence
      - MCP_DATA_DIR=/var/mcp-jupyter
      
      # Security (RELAXED)
      - MCP_STRICT_MODE=0  # Allow wildcard packages
      - MCP_DEV_MODE=1
      # MCP_PACKAGE_ALLOWLIST not set (allow all)
      
      # Resource Limits (Lower for local dev)
      - MCP_MAX_KERNELS=3
      - MCP_MEMORY_LIMIT_BYTES=4294967296  # 4 GB
      - MCP_IO_POOL_SIZE=2
    
    # Resource Limits (Lower for local machine)
    mem_limit: 8g
    cpus: 2.0
    
    ports:
      - "3000:3000"
    
    # User (match host user for file permissions)
    user: "${UID:-1000}:${GID:-1000}"
    
    # Health Check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 60s
      timeout: 5s
      retries: 3
    
    # Logging
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

# Development Notes:
# 1. No strict mode - faster package installs
# 2. No session token - open access (localhost only!)
# 3. Source code mounted for hot-reload
# 4. Lower resource limits for local machine
# 5. DO NOT USE IN PRODUCTION
